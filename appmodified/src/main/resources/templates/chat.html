<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Real-Time Modified Chat Application</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
          rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@7.2.0/bundles/stomp.umd.min.js"></script>
</head>

<body>
<div class="container mt-4">

    <h1 class="text-center">Real-Time Modified Chat Application</h1>

    <div id="chat"
         class="border rounded p-3 mb-3"
         style="height:300px; overflow-y:auto;">
    </div>

    <div class="input-group mb-3">
        <input id="senderInput"
               type="text"
               class="form-control"
               placeholder="Your Name..."/>
    </div>

    <div class="input-group mb-3">
        <input id="messageInput"
               type="text"
               class="form-control"
               placeholder="Type a Message..."/>

        <button id="sendMessage"
                class="btn btn-primary">
            Send
        </button>
    </div>

</div>

<script>

    let stompClient = null;

    function connect() {

        const socket = new SockJS('/ws');

        stompClient = new StompJs.Client({
            webSocketFactory: () => socket,
            reconnectDelay: 5000
        });

        stompClient.onConnect = function () {

            stompClient.subscribe('/topic/messages', function (message) {
                showMessage(JSON.parse(message.body));
            });
        };

        stompClient.activate();
    }

    function showMessage(message) {

        const chat = document.getElementById('chat');
        const messageElement = document.createElement('div');

        messageElement.textContent =
            message.sender + " : " + message.content;

        messageElement.className = "border-bottom mb-1";

        chat.appendChild(messageElement);
        chat.scrollTop = chat.scrollHeight;
    }

    function sendMessage() {

        const sender =
            document.getElementById('senderInput').value;

        const content =
            document.getElementById('messageInput').value;

        if (!sender || !content) return;

        stompClient.publish({
            destination: '/app/sendMessage',
            body: JSON.stringify({
                sender: sender,
                content: content
            })
        });

        document.getElementById('messageInput').value = '';
    }

    document.getElementById('sendMessage')
        .addEventListener("click", sendMessage);

    window.onload = connect;

</script>

</body>
</html>
